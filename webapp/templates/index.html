<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·¨é“¾VCç³»ç»Ÿç›‘æ§é¢æ¿</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .status-online { background-color: #27ae60; }
        .status-offline { background-color: #e74c3c; }
        .status-error { background-color: #f39c12; }
        .status-unknown { background-color: #95a5a6; }

        .status-text {
            font-size: 0.9em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-online .status-text { color: #27ae60; }
        .status-offline .status-text { color: #e74c3c; }
        .status-error .status-text { color: #f39c12; }
        .status-unknown .status-text { color: #95a5a6; }

        .card-content {
            font-size: 0.95em;
            line-height: 1.6;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }

        .info-label {
            font-weight: 600;
            color: #555;
        }

        .info-value {
            color: #2c3e50;
            font-family: 'Courier New', monospace;
        }

        .transfer-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .transfer-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .transfer-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }

        .form-input, .form-select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .transfer-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            grid-column: 1 / -1;
            justify-self: center;
            width: 200px;
        }

        .transfer-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .transfer-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .transfer-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .transfer-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .transfer-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .logs-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .logs-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .logs-content {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-timestamp {
            color: #95a5a6;
        }

        .log-level-info { color: #3498db; }
        .log-level-success { color: #27ae60; }
        .log-level-warning { color: #f39c12; }
        .log-level-error { color: #e74c3c; }

        .refresh-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .refresh-button:hover {
            background: #2980b9;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .transfer-form {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”— è·¨é“¾VCç³»ç»Ÿç›‘æ§é¢æ¿</h1>
            <p>å®æ—¶ç›‘æ§Besué“¾ã€OracleæœåŠ¡ã€ACA-Pyå’Œæ™ºèƒ½åˆçº¦çŠ¶æ€</p>
        </div>

        <div class="dashboard">
            <!-- Besu Chain A -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ”— Besu Chain A</div>
                    <div class="status-indicator status-unknown" id="besu-a-status"></div>
                </div>
                <div class="card-content" id="besu-a-content">
                    <div class="info-item">
                        <span class="info-label">çŠ¶æ€:</span>
                        <span class="info-value status-text" id="besu-a-status-text">æ£€æŸ¥ä¸­...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">é“¾ID:</span>
                        <span class="info-value" id="besu-a-chain-id">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æœ€æ–°åŒºå—:</span>
                        <span class="info-value" id="besu-a-block">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Gasä»·æ ¼:</span>
                        <span class="info-value" id="besu-a-gas">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æµ‹è¯•è´¦æˆ·ä½™é¢:</span>
                        <span class="info-value" id="besu-a-balance">-</span>
                    </div>
                </div>
            </div>

            <!-- Besu Chain B -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ”— Besu Chain B</div>
                    <div class="status-indicator status-unknown" id="besu-b-status"></div>
                </div>
                <div class="card-content" id="besu-b-content">
                    <div class="info-item">
                        <span class="info-label">çŠ¶æ€:</span>
                        <span class="info-value status-text" id="besu-b-status-text">æ£€æŸ¥ä¸­...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">é“¾ID:</span>
                        <span class="info-value" id="besu-b-chain-id">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æœ€æ–°åŒºå—:</span>
                        <span class="info-value" id="besu-b-block">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Gasä»·æ ¼:</span>
                        <span class="info-value" id="besu-b-gas">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æµ‹è¯•è´¦æˆ·ä½™é¢:</span>
                        <span class="info-value" id="besu-b-balance">-</span>
                    </div>
                </div>
            </div>

            <!-- Oracle Service -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ”® OracleæœåŠ¡</div>
                    <div class="status-indicator status-unknown" id="oracle-status"></div>
                </div>
                <div class="card-content" id="oracle-content">
                    <div class="info-item">
                        <span class="info-label">çŠ¶æ€:</span>
                        <span class="info-value status-text" id="oracle-status-text">æ£€æŸ¥ä¸­...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">URL:</span>
                        <span class="info-value" id="oracle-url">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ¶ˆæ¯:</span>
                        <span class="info-value" id="oracle-message">-</span>
                    </div>
                </div>
            </div>

            <!-- ACA-Py Issuer -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ“œ ACA-Pyå‘è¡Œè€…</div>
                    <div class="status-indicator status-unknown" id="acapy-issuer-status"></div>
                </div>
                <div class="card-content" id="acapy-issuer-content">
                    <div class="info-item">
                        <span class="info-label">çŠ¶æ€:</span>
                        <span class="info-value status-text" id="acapy-issuer-status-text">æ£€æŸ¥ä¸­...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ç®¡ç†URL:</span>
                        <span class="info-value" id="acapy-issuer-url">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ¶ˆæ¯:</span>
                        <span class="info-value" id="acapy-issuer-message">-</span>
                    </div>
                </div>
            </div>

            <!-- ACA-Py Holder -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ‘¤ ACA-PyæŒæœ‰è€…</div>
                    <div class="status-indicator status-unknown" id="acapy-holder-status"></div>
                </div>
                <div class="card-content" id="acapy-holder-content">
                    <div class="info-item">
                        <span class="info-label">çŠ¶æ€:</span>
                        <span class="info-value status-text" id="acapy-holder-status-text">æ£€æŸ¥ä¸­...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ç®¡ç†URL:</span>
                        <span class="info-value" id="acapy-holder-url">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ¶ˆæ¯:</span>
                        <span class="info-value" id="acapy-holder-message">-</span>
                    </div>
                </div>
            </div>

            <!-- VC Status -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ« VCçŠ¶æ€</div>
                    <div class="status-indicator status-unknown" id="vc-status"></div>
                </div>
                <div class="card-content" id="vc-content">
                    <div class="info-item">
                        <span class="info-label">çŠ¶æ€:</span>
                        <span class="info-value status-text" id="vc-status-text">æ£€æŸ¥ä¸­...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Schemaæ³¨å†Œ:</span>
                        <span class="info-value" id="vc-schema">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å‡­è¯å®šä¹‰:</span>
                        <span class="info-value" id="vc-cred-def">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">VCé¢å‘:</span>
                        <span class="info-value" id="vc-issued">-</span>
                    </div>
                </div>
            </div>

            <!-- Smart Contracts -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ“‹ æ™ºèƒ½åˆçº¦</div>
                    <div class="status-indicator status-unknown" id="contracts-status"></div>
                </div>
                <div class="card-content" id="contracts-content">
                    <div class="info-item">
                        <span class="info-label">çŠ¶æ€:</span>
                        <span class="info-value status-text" id="contracts-status-text">æ£€æŸ¥ä¸­...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ¡¥æ¥åˆçº¦:</span>
                        <span class="info-value" id="contracts-bridge">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">éªŒè¯åˆçº¦:</span>
                        <span class="info-value" id="contracts-verifier">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ä»£å¸åˆçº¦:</span>
                        <span class="info-value" id="contracts-token">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- è·¨é“¾è½¬è´¦åŒºåŸŸ -->
        <div class="transfer-section">
            <div class="transfer-title">ğŸ’¸ è·¨é“¾è½¬è´¦æ“ä½œ</div>
            <form class="transfer-form" id="transferForm">
                <div class="form-group">
                    <label class="form-label" for="amount">è½¬è´¦é‡‘é¢ (ETH)</label>
                    <input type="number" id="amount" name="amount" class="form-input" step="0.001" min="0" placeholder="0.001" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="fromChain">æºé“¾</label>
                    <select id="fromChain" name="fromChain" class="form-select" required>
                        <option value="besu_chain_a">Besu Chain A</option>
                        <option value="besu_chain_b">Besu Chain B</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="toChain">ç›®æ ‡é“¾</label>
                    <select id="toChain" name="toChain" class="form-select" required>
                        <option value="besu_chain_b">Besu Chain B</option>
                        <option value="besu_chain_a">Besu Chain A</option>
                    </select>
                </div>
                <button type="submit" class="transfer-button" id="transferButton">
                    æ‰§è¡Œè·¨é“¾è½¬è´¦
                </button>
            </form>
            <div class="transfer-result" id="transferResult"></div>
        </div>

        <!-- æ—¥å¿—åŒºåŸŸ -->
        <div class="logs-section">
            <div class="logs-title">
                ç³»ç»Ÿæ—¥å¿—
                <button class="refresh-button" onclick="refreshStatus()">åˆ·æ–°çŠ¶æ€</button>
            </div>
            <div class="logs-content" id="logsContent">
                <div class="log-entry">
                    <span class="log-timestamp">[2025-01-12 12:00:00]</span>
                    <span class="log-level-info">[INFO]</span>
                    ç³»ç»Ÿå¯åŠ¨ä¸­...
                </div>
            </div>
        </div>
    </div>

    <script>
        // WebSocketè¿æ¥
        const socket = io();
        
        // çŠ¶æ€æ›´æ–°å¤„ç†
        socket.on('status_update', function(data) {
            updateDashboard(data);
        });

        // æ›´æ–°ä»ªè¡¨æ¿
        function updateDashboard(status) {
            // æ›´æ–°Besu Chain A
            updateServiceStatus('besu-a', status.besu_chain_a);
            
            // æ›´æ–°Besu Chain B
            updateServiceStatus('besu-b', status.besu_chain_b);
            
            // æ›´æ–°OracleæœåŠ¡
            updateServiceStatus('oracle', status.oracle_service);
            
            // æ›´æ–°ACA-Pyå‘è¡Œè€…
            updateServiceStatus('acapy-issuer', status.acapy_issuer);
            
            // æ›´æ–°ACA-PyæŒæœ‰è€…
            updateServiceStatus('acapy-holder', status.acapy_holder);
            
            // æ›´æ–°VCçŠ¶æ€
            updateServiceStatus('vc', status.vc_status);
            
            // æ›´æ–°æ™ºèƒ½åˆçº¦
            updateServiceStatus('contracts', status.contracts);
            
            // æ·»åŠ æ—¥å¿—
            addLog('info', 'ç³»ç»ŸçŠ¶æ€å·²æ›´æ–°');
        }

        // æ›´æ–°æœåŠ¡çŠ¶æ€
        function updateServiceStatus(prefix, serviceStatus) {
            const statusElement = document.getElementById(`${prefix}-status`);
            const statusTextElement = document.getElementById(`${prefix}-status-text`);
            
            if (serviceStatus) {
                // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
                statusElement.className = `status-indicator status-${serviceStatus.status}`;
                statusTextElement.textContent = serviceStatus.status.toUpperCase();
                statusTextElement.className = `info-value status-text status-${serviceStatus.status}`;
                
                // æ›´æ–°è¯¦ç»†ä¿¡æ¯
                if (serviceStatus.details) {
                    const details = serviceStatus.details;
                    
                    // æ ¹æ®æœåŠ¡ç±»å‹æ›´æ–°ä¸åŒçš„å­—æ®µ
                    if (prefix.startsWith('besu-')) {
                        updateElement(`${prefix}-chain-id`, details.chain_id || '-');
                        updateElement(`${prefix}-block`, details.latest_block || '-');
                        updateElement(`${prefix}-gas`, details.gas_price || '-');
                        updateElement(`${prefix}-balance`, details.test_account_balance ? `${details.test_account_balance} ETH` : '-');
                    } else if (prefix === 'oracle') {
                        updateElement(`${prefix}-url`, details.url || '-');
                        updateElement(`${prefix}-message`, details.message || '-');
                    } else if (prefix.startsWith('acapy-')) {
                        updateElement(`${prefix}-url`, details.admin_url || '-');
                        updateElement(`${prefix}-message`, details.message || '-');
                    } else if (prefix === 'vc') {
                        updateElement(`${prefix}-schema`, details.schema_registered ? 'âœ… å·²æ³¨å†Œ' : 'âŒ æœªæ³¨å†Œ');
                        updateElement(`${prefix}-cred-def`, details.cred_def_created ? 'âœ… å·²åˆ›å»º' : 'âŒ æœªåˆ›å»º');
                        updateElement(`${prefix}-issued`, details.vc_issued ? 'âœ… å·²é¢å‘' : 'âŒ æœªé¢å‘');
                    } else if (prefix === 'contracts') {
                        updateElement(`${prefix}-bridge`, details.bridge_contract || '-');
                        updateElement(`${prefix}-verifier`, details.verifier_contract || '-');
                        updateElement(`${prefix}-token`, details.token_contract || '-');
                    }
                }
            }
        }

        // æ›´æ–°å…ƒç´ å†…å®¹
        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(level, message) {
            const logsContent = document.getElementById('logsContent');
            const timestamp = new Date().toLocaleString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                ${message}
            `;
            logsContent.appendChild(logEntry);
            logsContent.scrollTop = logsContent.scrollHeight;
        }

        // åˆ·æ–°çŠ¶æ€
        function refreshStatus() {
            addLog('info', 'æ‰‹åŠ¨åˆ·æ–°ç³»ç»ŸçŠ¶æ€...');
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    updateDashboard(data);
                    addLog('success', 'ç³»ç»ŸçŠ¶æ€åˆ·æ–°å®Œæˆ');
                })
                .catch(error => {
                    addLog('error', `åˆ·æ–°å¤±è´¥: ${error.message}`);
                });
        }

        // è½¬è´¦è¡¨å•å¤„ç†
        document.getElementById('transferForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                amount: parseFloat(formData.get('amount')),
                from_chain: formData.get('fromChain'),
                to_chain: formData.get('toChain')
            };
            
            const transferButton = document.getElementById('transferButton');
            const transferResult = document.getElementById('transferResult');
            
            // ç¦ç”¨æŒ‰é’®
            transferButton.disabled = true;
            transferButton.textContent = 'è½¬è´¦ä¸­...';
            
            // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
            transferResult.style.display = 'none';
            
            addLog('info', `å¼€å§‹è·¨é“¾è½¬è´¦: ${data.amount} ETH ä» ${data.from_chain} åˆ° ${data.to_chain}`);
            
            // å‘é€è½¬è´¦è¯·æ±‚
            fetch('/api/transfer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    transferResult.className = 'transfer-result transfer-success';
                    transferResult.innerHTML = `
                        <strong>è½¬è´¦æˆåŠŸ!</strong><br>
                        äº¤æ˜“å“ˆå¸Œ: ${result.transaction_hash}<br>
                        é‡‘é¢: ${result.amount} ETH<br>
                        ä»: ${result.from_chain}<br>
                        åˆ°: ${result.to_chain}<br>
                        æ—¶é—´: ${result.timestamp}
                    `;
                    addLog('success', `è½¬è´¦æˆåŠŸ: ${result.transaction_hash}`);
                } else {
                    transferResult.className = 'transfer-result transfer-error';
                    transferResult.innerHTML = `
                        <strong>è½¬è´¦å¤±è´¥!</strong><br>
                        é”™è¯¯: ${result.error}
                    `;
                    addLog('error', `è½¬è´¦å¤±è´¥: ${result.error}`);
                }
                transferResult.style.display = 'block';
            })
            .catch(error => {
                transferResult.className = 'transfer-result transfer-error';
                transferResult.innerHTML = `
                    <strong>è½¬è´¦å¤±è´¥!</strong><br>
                    é”™è¯¯: ${error.message}
                `;
                transferResult.style.display = 'block';
                addLog('error', `è½¬è´¦è¯·æ±‚å¤±è´¥: ${error.message}`);
            })
            .finally(() => {
                // æ¢å¤æŒ‰é’®
                transferButton.disabled = false;
                transferButton.textContent = 'æ‰§è¡Œè·¨é“¾è½¬è´¦';
            });
        });

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('info', 'é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹ç›‘æ§ç³»ç»ŸçŠ¶æ€...');
            refreshStatus();
        });
    </script>
</body>
</html>
