<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë∑®ÈìæVCÁ≥ªÁªüÁõëÊéßÈù¢Êùø - Â¢ûÂº∫Áâà</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .status-online { background-color: #27ae60; }
        .status-offline { background-color: #e74c3c; }
        .status-error { background-color: #f39c12; }
        .status-unknown { background-color: #95a5a6; }

        .status-text {
            font-size: 0.9em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-online .status-text { color: #27ae60; }
        .status-offline .status-text { color: #e74c3c; }
        .status-error .status-text { color: #f39c12; }
        .status-unknown .status-text { color: #95a5a6; }

        .card-content {
            font-size: 0.95em;
            line-height: 1.6;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }

        .info-label {
            font-weight: 600;
            color: #555;
        }

        .info-value {
            color: #2c3e50;
            font-family: 'Courier New', monospace;
        }

        .transfer-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .transfer-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .transfer-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }

        .form-input, .form-select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .transfer-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            grid-column: 1 / -1;
            justify-self: center;
            width: 200px;
        }

        .transfer-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .transfer-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .transfer-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .transfer-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .transfer-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .history-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .history-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .history-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }

        .history-table tr:hover {
            background-color: #f5f5f5;
        }

        .status-success {
            color: #27ae60;
            font-weight: bold;
        }

        .status-failed {
            color: #e74c3c;
            font-weight: bold;
        }

        .tx-hash {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #667eea;
            cursor: pointer;
        }

        .tx-hash:hover {
            text-decoration: underline;
        }

        .logs-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .logs-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .logs-content {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-timestamp {
            color: #95a5a6;
        }

        .log-level-info { color: #3498db; }
        .log-level-success { color: #27ae60; }
        .log-level-warning { color: #f39c12; }
        .log-level-error { color: #e74c3c; }

        .refresh-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .refresh-button:hover {
            background: #2980b9;
        }

        .empty-state {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 40px;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .transfer-form {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }

            .history-table {
                font-size: 0.8em;
            }

            .history-table th,
            .history-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîó Ë∑®ÈìæVCÁ≥ªÁªüÁõëÊéßÈù¢Êùø - Â¢ûÂº∫Áâà</h1>
            <p>ÂÆûÊó∂ÁõëÊéßBesuÈìæ„ÄÅOracleÊúçÂä°„ÄÅACA-PyÂíåÊô∫ËÉΩÂêàÁ∫¶Áä∂ÊÄÅÔºåÊîØÊåÅÁúüÂÆûË∑®ÈìæËΩ¨Ë¥¶</p>
            <div style="margin-top: 20px;">
                <a href="/vc-data" style="background: rgba(255, 255, 255, 0.2); color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: bold; margin: 0 10px; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">Êü•ÁúãVCÊï∞ÊçÆ‰∏éÂêàÁ∫¶ÂèòÈáè</a>
            </div>
        </div>

        <div class="dashboard">
            <!-- Besu Chain A -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üîó Besu Chain A</div>
                    <div class="status-indicator status-unknown" id="besu-a-status"></div>
                </div>
                <div class="card-content" id="besu-a-content">
                    <div class="info-item">
                        <span class="info-label">Áä∂ÊÄÅ:</span>
                        <span class="info-value status-text" id="besu-a-status-text">Ê£ÄÊü•‰∏≠...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ÈìæID:</span>
                        <span class="info-value" id="besu-a-chain-id">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ÊúÄÊñ∞Âå∫Âùó:</span>
                        <span class="info-value" id="besu-a-block">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Gas‰ª∑Ê†º:</span>
                        <span class="info-value" id="besu-a-gas">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ÊµãËØïË¥¶Êà∑‰ΩôÈ¢ù:</span>
                        <span class="info-value" id="besu-a-balance">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ÊµãËØïË¥¶Êà∑Âú∞ÂùÄ:</span>
                        <span class="info-value" id="besu-a-address">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Nonce:</span>
                        <span class="info-value" id="besu-a-nonce">-</span>
                    </div>
                </div>
            </div>

            <!-- Besu Chain B -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üîó Besu Chain B</div>
                    <div class="status-indicator status-unknown" id="besu-b-status"></div>
                </div>
                <div class="card-content" id="besu-b-content">
                    <div class="info-item">
                        <span class="info-label">Áä∂ÊÄÅ:</span>
                        <span class="info-value status-text" id="besu-b-status-text">Ê£ÄÊü•‰∏≠...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ÈìæID:</span>
                        <span class="info-value" id="besu-b-chain-id">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ÊúÄÊñ∞Âå∫Âùó:</span>
                        <span class="info-value" id="besu-b-block">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Gas‰ª∑Ê†º:</span>
                        <span class="info-value" id="besu-b-gas">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ÊµãËØïË¥¶Êà∑‰ΩôÈ¢ù:</span>
                        <span class="info-value" id="besu-b-balance">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ÊµãËØïË¥¶Êà∑Âú∞ÂùÄ:</span>
                        <span class="info-value" id="besu-b-address">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Nonce:</span>
                        <span class="info-value" id="besu-b-nonce">-</span>
                    </div>
                </div>
            </div>

            <!-- Oracle Service -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üîÆ OracleÊúçÂä°</div>
                    <div class="status-indicator status-unknown" id="oracle-status"></div>
                </div>
                <div class="card-content" id="oracle-content">
                    <div class="info-item">
                        <span class="info-label">Áä∂ÊÄÅ:</span>
                        <span class="info-value status-text" id="oracle-status-text">Ê£ÄÊü•‰∏≠...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">URL:</span>
                        <span class="info-value" id="oracle-url">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Ê∂àÊÅØ:</span>
                        <span class="info-value" id="oracle-message">-</span>
                    </div>
                </div>
            </div>

            <!-- ACA-Py Issuer -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üìú ACA-PyÂèëË°åËÄÖ</div>
                    <div class="status-indicator status-unknown" id="acapy-issuer-status"></div>
                </div>
                <div class="card-content" id="acapy-issuer-content">
                    <div class="info-item">
                        <span class="info-label">Áä∂ÊÄÅ:</span>
                        <span class="info-value status-text" id="acapy-issuer-status-text">Ê£ÄÊü•‰∏≠...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ÁÆ°ÁêÜURL:</span>
                        <span class="info-value" id="acapy-issuer-url">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Ê∂àÊÅØ:</span>
                        <span class="info-value" id="acapy-issuer-message">-</span>
                    </div>
                </div>
            </div>

            <!-- ACA-Py Holder -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üë§ ACA-PyÊåÅÊúâËÄÖ</div>
                    <div class="status-indicator status-unknown" id="acapy-holder-status"></div>
                </div>
                <div class="card-content" id="acapy-holder-content">
                    <div class="info-item">
                        <span class="info-label">Áä∂ÊÄÅ:</span>
                        <span class="info-value status-text" id="acapy-holder-status-text">Ê£ÄÊü•‰∏≠...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ÁÆ°ÁêÜURL:</span>
                        <span class="info-value" id="acapy-holder-url">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Ê∂àÊÅØ:</span>
                        <span class="info-value" id="acapy-holder-message">-</span>
                    </div>
                </div>
            </div>

            <!-- VC Status -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üé´ VCÁä∂ÊÄÅ</div>
                    <div class="status-indicator status-unknown" id="vc-status"></div>
                </div>
                <div class="card-content" id="vc-content">
                    <div class="info-item">
                        <span class="info-label">Áä∂ÊÄÅ:</span>
                        <span class="info-value status-text" id="vc-status-text">Ê£ÄÊü•‰∏≠...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">SchemaÊ≥®ÂÜå:</span>
                        <span class="info-value" id="vc-schema">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Âá≠ËØÅÂÆö‰πâ:</span>
                        <span class="info-value" id="vc-cred-def">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">VCÈ¢ÅÂèë:</span>
                        <span class="info-value" id="vc-issued">-</span>
                    </div>
                </div>
            </div>

            <!-- Smart Contracts -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üìã Êô∫ËÉΩÂêàÁ∫¶</div>
                    <div class="status-indicator status-unknown" id="contracts-status"></div>
                </div>
                <div class="card-content" id="contracts-content">
                    <div class="info-item">
                        <span class="info-label">Áä∂ÊÄÅ:</span>
                        <span class="info-value status-text" id="contracts-status-text">Ê£ÄÊü•‰∏≠...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Ê°•Êé•ÂêàÁ∫¶:</span>
                        <span class="info-value" id="contracts-bridge">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">È™åËØÅÂêàÁ∫¶:</span>
                        <span class="info-value" id="contracts-verifier">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">‰ª£Â∏ÅÂêàÁ∫¶:</span>
                        <span class="info-value" id="contracts-token">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ë∑®ÈìæËΩ¨Ë¥¶Âå∫Âüü -->
        <div class="transfer-section">
            <div class="transfer-title">üí∏ Ë∑®ÈìæËΩ¨Ë¥¶Êìç‰Ωú</div>
            <form class="transfer-form" id="transferForm">
                <div class="form-group">
                    <label class="form-label" for="amount">ËΩ¨Ë¥¶ÈáëÈ¢ù (ETH)</label>
                    <input type="number" id="amount" name="amount" class="form-input" step="0.001" min="0" placeholder="0.001" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="fromChain">Ê∫êÈìæ</label>
                    <select id="fromChain" name="fromChain" class="form-select" required>
                        <option value="chain_a">Besu Chain A</option>
                        <option value="chain_b">Besu Chain B</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="toChain">ÁõÆÊ†áÈìæ</label>
                    <select id="toChain" name="toChain" class="form-select" required>
                        <option value="chain_b">Besu Chain B</option>
                        <option value="chain_a">Besu Chain A</option>
                    </select>
                </div>
                <button type="submit" class="transfer-button" id="transferButton">
                    ÊâßË°åË∑®ÈìæËΩ¨Ë¥¶
                </button>
            </form>
            <div class="transfer-result" id="transferResult"></div>
        </div>

        <!-- ËΩ¨Ë¥¶ÂéÜÂè≤Âå∫Âüü -->
        <div class="history-section">
            <div class="history-title">
                ËΩ¨Ë¥¶ÂéÜÂè≤
                <button class="refresh-button" onclick="refreshHistory()">Âà∑Êñ∞ÂéÜÂè≤</button>
            </div>
            <table class="history-table" id="historyTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Êó∂Èó¥</th>
                        <th>ÈáëÈ¢ù (ETH)</th>
                        <th>Ê∫êÈìæ</th>
                        <th>ÁõÆÊ†áÈìæ</th>
                        <th>ÈîÅÂÆö‰∫§Êòì</th>
                        <th>ÈáäÊîæ‰∫§Êòì</th>
                        <th>Ê∫êÈìæÂèòÂåñ</th>
                        <th>ÁõÆÊ†áÈìæÂèòÂåñ</th>
                        <th>Áä∂ÊÄÅ</th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                    <tr>
                        <td colspan="10" class="empty-state">ÊöÇÊó†ËΩ¨Ë¥¶ËÆ∞ÂΩï</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Êó•ÂøóÂå∫Âüü -->
        <div class="logs-section">
            <div class="logs-title">
                Á≥ªÁªüÊó•Âøó
                <button class="refresh-button" onclick="refreshStatus()">Âà∑Êñ∞Áä∂ÊÄÅ</button>
            </div>
            <div class="logs-content" id="logsContent">
                <div class="log-entry">
                    <span class="log-timestamp">[2025-01-12 12:00:00]</span>
                    <span class="log-level-info">[INFO]</span>
                    Á≥ªÁªüÂêØÂä®‰∏≠...
                </div>
            </div>
        </div>
    </div>

    <script>
        // WebSocketËøûÊé•
        const socket = io();
        
        // Áä∂ÊÄÅÊõ¥Êñ∞Â§ÑÁêÜ
        socket.on('status_update', function(data) {
            updateDashboard(data);
        });

        // Êõ¥Êñ∞‰ª™Ë°®Êùø
        function updateDashboard(status) {
            // Êõ¥Êñ∞Besu Chain A
            updateServiceStatus('besu-a', status.besu_chain_a);
            
            // Êõ¥Êñ∞Besu Chain B
            updateServiceStatus('besu-b', status.besu_chain_b);
            
            // Êõ¥Êñ∞OracleÊúçÂä°
            updateServiceStatus('oracle', status.oracle_service);
            
            // Êõ¥Êñ∞ACA-PyÂèëË°åËÄÖ
            updateServiceStatus('acapy-issuer', status.acapy_issuer);
            
            // Êõ¥Êñ∞ACA-PyÊåÅÊúâËÄÖ
            updateServiceStatus('acapy-holder', status.acapy_holder);
            
            // Êõ¥Êñ∞VCÁä∂ÊÄÅ
            updateServiceStatus('vc', status.vc_status);
            
            // Êõ¥Êñ∞Êô∫ËÉΩÂêàÁ∫¶
            updateServiceStatus('contracts', status.contracts);
            
            // Ê∑ªÂä†Êó•Âøó
            addLog('info', 'Á≥ªÁªüÁä∂ÊÄÅÂ∑≤Êõ¥Êñ∞');
        }

        // Êõ¥Êñ∞ÊúçÂä°Áä∂ÊÄÅ
        function updateServiceStatus(prefix, serviceStatus) {
            const statusElement = document.getElementById(`${prefix}-status`);
            const statusTextElement = document.getElementById(`${prefix}-status-text`);
            
            if (serviceStatus) {
                // Êõ¥Êñ∞Áä∂ÊÄÅÊåáÁ§∫Âô®
                statusElement.className = `status-indicator status-${serviceStatus.status}`;
                statusTextElement.textContent = serviceStatus.status.toUpperCase();
                statusTextElement.className = `info-value status-text status-${serviceStatus.status}`;
                
                // Êõ¥Êñ∞ËØ¶ÁªÜ‰ø°ÊÅØ
                if (serviceStatus.details) {
                    const details = serviceStatus.details;
                    
                    // Ê†πÊçÆÊúçÂä°Á±ªÂûãÊõ¥Êñ∞‰∏çÂêåÁöÑÂ≠óÊÆµ
                    if (prefix.startsWith('besu-')) {
                        updateElement(`${prefix}-chain-id`, details.chain_id || '-');
                        updateElement(`${prefix}-block`, details.latest_block || '-');
                        updateElement(`${prefix}-gas`, details.gas_price || '-');
                        updateElement(`${prefix}-balance`, details.test_account_balance ? `${details.test_account_balance} ETH` : '-');
                        updateElement(`${prefix}-address`, details.test_account_address || '-');
                        updateElement(`${prefix}-nonce`, details.test_account_nonce || '-');
                    } else if (prefix === 'oracle') {
                        updateElement(`${prefix}-url`, details.url || '-');
                        updateElement(`${prefix}-message`, details.message || '-');
                    } else if (prefix.startsWith('acapy-')) {
                        updateElement(`${prefix}-url`, details.admin_url || '-');
                        updateElement(`${prefix}-message`, details.message || '-');
                    } else if (prefix === 'vc') {
                        updateElement(`${prefix}-schema`, details.schema_registered ? '‚úÖ Â∑≤Ê≥®ÂÜå' : '‚ùå Êú™Ê≥®ÂÜå');
                        updateElement(`${prefix}-cred-def`, details.cred_def_created ? '‚úÖ Â∑≤ÂàõÂª∫' : '‚ùå Êú™ÂàõÂª∫');
                        updateElement(`${prefix}-issued`, details.vc_issued ? '‚úÖ Â∑≤È¢ÅÂèë' : '‚ùå Êú™È¢ÅÂèë');
                    } else if (prefix === 'contracts') {
                        updateElement(`${prefix}-bridge`, details.bridge_contract || '-');
                        updateElement(`${prefix}-verifier`, details.verifier_contract || '-');
                        updateElement(`${prefix}-token`, details.token_contract || '-');
                    }
                }
            }
        }

        // Êõ¥Êñ∞ÂÖÉÁ¥†ÂÜÖÂÆπ
        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }

        // Ê∑ªÂä†Êó•Âøó
        function addLog(level, message) {
            const logsContent = document.getElementById('logsContent');
            const timestamp = new Date().toLocaleString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                ${message}
            `;
            logsContent.appendChild(logEntry);
            logsContent.scrollTop = logsContent.scrollHeight;
        }

        // Âà∑Êñ∞Áä∂ÊÄÅ
        function refreshStatus() {
            addLog('info', 'ÊâãÂä®Âà∑Êñ∞Á≥ªÁªüÁä∂ÊÄÅ...');
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    updateDashboard(data);
                    addLog('success', 'Á≥ªÁªüÁä∂ÊÄÅÂà∑Êñ∞ÂÆåÊàê');
                })
                .catch(error => {
                    addLog('error', `Âà∑Êñ∞Â§±Ë¥•: ${error.message}`);
                });
        }

        // Âà∑Êñ∞ËΩ¨Ë¥¶ÂéÜÂè≤
        function refreshHistory() {
            addLog('info', 'Âà∑Êñ∞ËΩ¨Ë¥¶ÂéÜÂè≤...');
            fetch('/api/transfer-history')
                .then(response => response.json())
                .then(data => {
                    updateHistoryTable(data);
                    addLog('success', 'ËΩ¨Ë¥¶ÂéÜÂè≤Âà∑Êñ∞ÂÆåÊàê');
                })
                .catch(error => {
                    addLog('error', `Âà∑Êñ∞ÂéÜÂè≤Â§±Ë¥•: ${error.message}`);
                });
        }

        // Êõ¥Êñ∞ËΩ¨Ë¥¶ÂéÜÂè≤Ë°®Ê†º
        function updateHistoryTable(history) {
            const tbody = document.getElementById('historyTableBody');
            
            if (history.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="empty-state">ÊöÇÊó†ËΩ¨Ë¥¶ËÆ∞ÂΩï</td></tr>';
                return;
            }
            
            tbody.innerHTML = history.map(record => `
                <tr>
                    <td>${record.id}</td>
                    <td>${new Date(record.timestamp).toLocaleString()}</td>
                    <td>${record.amount}</td>
                    <td>${record.from_chain}</td>
                    <td>${record.to_chain}</td>
                    <td class="tx-hash" title="ÁÇπÂáªÂ§çÂà∂">${record.lock_tx_hash || '-'}</td>
                    <td class="tx-hash" title="ÁÇπÂáªÂ§çÂà∂">${record.release_tx_hash || '-'}</td>
                    <td>${record.source_change ? record.source_change + ' ETH' : '-'}</td>
                    <td>${record.target_change ? record.target_change + ' ETH' : '-'}</td>
                    <td class="status-${record.status}">${record.status === 'success' ? 'ÊàêÂäü' : 'Â§±Ë¥•'}</td>
                </tr>
            `).join('');
            
            // Ê∑ªÂä†ÁÇπÂáªÂ§çÂà∂ÂäüËÉΩ
            document.querySelectorAll('.tx-hash').forEach(element => {
                element.addEventListener('click', function() {
                    navigator.clipboard.writeText(this.textContent);
                    addLog('info', `Â∑≤Â§çÂà∂‰∫§ÊòìÂìàÂ∏å: ${this.textContent}`);
                });
            });
        }

        // ËΩ¨Ë¥¶Ë°®ÂçïÂ§ÑÁêÜ
        document.getElementById('transferForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                amount: parseFloat(formData.get('amount')),
                from_chain: formData.get('fromChain'),
                to_chain: formData.get('toChain')
            };
            
            const transferButton = document.getElementById('transferButton');
            const transferResult = document.getElementById('transferResult');
            
            // Á¶ÅÁî®ÊåâÈíÆ
            transferButton.disabled = true;
            transferButton.textContent = 'ËΩ¨Ë¥¶‰∏≠...';
            
            // Ê∏ÖÁ©∫‰πãÂâçÁöÑÁªìÊûú
            transferResult.style.display = 'none';
            
            addLog('info', `ÂºÄÂßãË∑®ÈìæËΩ¨Ë¥¶: ${data.amount} ETH ‰ªé ${data.from_chain} Âà∞ ${data.to_chain}`);
            
            // ÂèëÈÄÅËΩ¨Ë¥¶ËØ∑Ê±Ç
            fetch('/api/transfer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    transferResult.className = 'transfer-result transfer-success';
                    transferResult.innerHTML = `
                        <strong>Ë∑®ÈìæËΩ¨Ë¥¶ÊàêÂäü!</strong><br>
                        ÈîÅÂÆö‰∫§Êòì: <span class="tx-hash">${result.lock_tx_hash}</span><br>
                        ÈáäÊîæ‰∫§Êòì: <span class="tx-hash">${result.release_tx_hash}</span><br>
                        ÈáëÈ¢ù: ${result.amount} ETH<br>
                        ‰ªé: ${result.from_chain} (${result.from_address})<br>
                        Âà∞: ${result.to_chain} (${result.to_address})<br>
                        ÈîÅÂÆöÂå∫Âùó: ${result.lock_block_number}<br>
                        ÈáäÊîæÂå∫Âùó: ${result.release_block_number}<br>
                        Ê∫êÈìæÂèòÂåñ: ${result.source_change} ETH<br>
                        ÁõÆÊ†áÈìæÂèòÂåñ: ${result.target_change} ETH<br>
                        Êó∂Èó¥: ${new Date(result.timestamp).toLocaleString()}
                    `;
                    addLog('success', `Ë∑®ÈìæËΩ¨Ë¥¶ÊàêÂäü: ÈîÅÂÆö${result.lock_tx_hash}, ÈáäÊîæ${result.release_tx_hash}`);
                    
                    // Âà∑Êñ∞ËΩ¨Ë¥¶ÂéÜÂè≤
                    refreshHistory();
                } else {
                    transferResult.className = 'transfer-result transfer-error';
                    transferResult.innerHTML = `
                        <strong>ËΩ¨Ë¥¶Â§±Ë¥•!</strong><br>
                        ÈîôËØØ: ${result.error}
                    `;
                    addLog('error', `ËΩ¨Ë¥¶Â§±Ë¥•: ${result.error}`);
                }
                transferResult.style.display = 'block';
            })
            .catch(error => {
                transferResult.className = 'transfer-result transfer-error';
                transferResult.innerHTML = `
                    <strong>ËΩ¨Ë¥¶Â§±Ë¥•!</strong><br>
                    ÈîôËØØ: ${error.message}
                `;
                transferResult.style.display = 'block';
                addLog('error', `ËΩ¨Ë¥¶ËØ∑Ê±ÇÂ§±Ë¥•: ${error.message}`);
            })
            .finally(() => {
                // ÊÅ¢Â§çÊåâÈíÆ
                transferButton.disabled = false;
                transferButton.textContent = 'ÊâßË°åË∑®ÈìæËΩ¨Ë¥¶';
            });
        });

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            addLog('info', 'È°µÈù¢Âä†ËΩΩÂÆåÊàêÔºåÂºÄÂßãÁõëÊéßÁ≥ªÁªüÁä∂ÊÄÅ...');
            refreshStatus();
            refreshHistory();
        });
    </script>
</body>
</html>
