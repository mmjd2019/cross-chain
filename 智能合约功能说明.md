# 智能合约功能说明

## 合约概述

`SimpleCrossChainTokenWithBridge` 是一个支持跨链转账的ERC20代币合约，集成了跨链桥接功能，允许用户在不同的区块链网络之间安全地转移代币。

## 核心功能模块

### 1. 基础ERC20功能

#### 代币基本信息
- `name`: 代币名称
- `symbol`: 代币符号
- `decimals`: 小数位数
- `totalSupply`: 总供应量

#### 余额管理
- `balances`: 用户余额映射
- `allowances`: 授权额度映射
- `balanceOf()`: 查询用户余额
- `allowance()`: 查询授权额度

#### 标准转账功能
- `transfer()`: 直接转账
- `approve()`: 授权转账
- `transferFrom()`: 授权转账执行

### 2. 跨链功能模块

#### 跨链配置
- `bridgeContract`: 桥接合约地址
- `owner`: 合约所有者
- `crossChainEnabled`: 跨链功能开关

#### 跨链锁定机制
```solidity
struct CrossChainLock {
    address user;        // 用户地址
    uint256 amount;      // 锁定金额
    string targetChain;  // 目标链标识
    uint256 lockTime;    // 锁定时间
    bool isUnlocked;     // 是否已解锁
}
```

#### 核心跨链函数
- `crossChainLock()`: 锁定代币用于跨链转移
- `crossChainUnlock()`: 在目标链解锁代币
- `getLockedBalance()`: 查询锁定余额
- `getAvailableBalance()`: 查询可用余额
- `getTotalBalance()`: 查询总余额

### 3. 代币管理功能

#### 铸造和销毁
- `mint()`: 铸造新代币（仅桥接合约可调用）
- `burn()`: 销毁代币（仅桥接合约可调用）

#### 权限控制
- `onlyOwner`: 仅合约所有者可调用
- `onlyBridge`: 仅桥接合约可调用
- `setBridgeContract()`: 设置桥接合约地址
- `setCrossChainEnabled()`: 启用/禁用跨链功能

## 事件定义

### 标准ERC20事件
- `Transfer`: 代币转账事件
- `Approval`: 授权事件

### 跨链事件
- `CrossChainLocked`: 跨链锁定事件
- `CrossChainUnlocked`: 跨链解锁事件

## 安全机制

### 1. 输入验证
- 地址零值检查
- 金额正数验证
- 余额充足性检查
- 授权额度验证

### 2. 权限控制
- 所有者权限：合约配置管理
- 桥接权限：跨链操作执行
- 用户权限：标准转账操作

### 3. 状态管理
- 锁定状态跟踪
- 跨链功能开关
- 余额状态同步

## 使用场景

### 1. 同链转账
用户可以在同一链内进行标准的ERC20代币转账操作。

### 2. 跨链转账
1. 用户在源链调用 `crossChainLock()` 锁定代币
2. 桥接服务监控锁定事件
3. 在目标链调用 `crossChainUnlock()` 解锁代币

### 3. 余额查询
- 查询可用余额：`getAvailableBalance()`
- 查询锁定余额：`getLockedBalance()`
- 查询总余额：`getTotalBalance()`

## 技术特点

### 1. 兼容性
- 完全兼容ERC20标准
- 支持现有钱包和交易所
- 标准事件和函数接口

### 2. 扩展性
- 模块化设计
- 可配置的桥接合约
- 支持多种跨链协议

### 3. 安全性
- 多重验证机制
- 权限分级管理
- 状态一致性保证

## 部署参数

### 构造函数参数
```solidity
constructor(
    string memory _name,      // 代币名称
    string memory _symbol,    // 代币符号
    uint8 _decimals,         // 小数位数
    uint256 _totalSupply     // 总供应量
)
```

### 初始化设置
1. 设置桥接合约地址：`setBridgeContract()`
2. 启用跨链功能：`setCrossChainEnabled(true)`
3. 配置权限和参数

## 最佳实践

### 1. 部署前检查
- 验证构造函数参数
- 检查权限设置
- 测试基本功能

### 2. 运行时监控
- 监控跨链事件
- 跟踪锁定状态
- 检查余额变化

### 3. 安全维护
- 定期检查权限
- 监控异常交易
- 及时更新配置
